<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¢å¼ºç‰ˆçƒŸèŠ±çˆ†ç‚¸</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      touch-action: none; /* é¿å…æ‰‹æœºç‚¹å‡»æ—¶çš„é»˜è®¤è¡Œä¸º */
    }
    canvas {
      display: block;
    }
    .tip {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 18px;
      opacity: 0.8;
      pointer-events: none; /* ä¸å½±å“ç‚¹å‡» */
    }
  </style>
</head>
<body>
  <canvas id="fireworks"></canvas>
  <div class="tip">ç‚¹å‡»å±å¹•æ”¾çƒŸèŠ± ğŸ‡</div>

  <script>
    const canvas = document.getElementById('fireworks');
    const ctx = canvas.getContext('2d');
    let width, height;
    let fireworks = [];
    let particles = [];
    let sparks = []; // çˆ†ç‚¸æ—¶çš„é—ªå…‰ç²’å­

    // é€‚é…å±å¹•
    function resizeCanvas() {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // çƒŸèŠ±å‘å°„ç±»
    class Firework {
      constructor(x, y) {
        this.x = x;
        this.y = height;
        this.targetX = x + (Math.random() - 0.5) * 50; // è½»å¾®åç§»ï¼Œæ›´è‡ªç„¶
        this.targetY = y + (Math.random() - 0.5) * 30;
        this.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
        this.velocity = 6 + Math.random() * 2; // é€Ÿåº¦éšæœº
        this.gravity = 0.03;
        this.reachedTarget = false;
        this.trail = []; // å‘å°„è½¨è¿¹
      }

      update() {
        if (!this.reachedTarget) {
          // è®°å½•è½¨è¿¹ï¼ˆè®©å‘å°„æ—¶æ›´æœ‰æ‹–å°¾æ„Ÿï¼‰
          this.trail.push({x: this.x, y: this.y});
          if (this.trail.length > 15) this.trail.shift();

          // å‘ç›®æ ‡ç‚¹è¿åŠ¨
          const dx = this.targetX - this.x;
          const dy = this.targetY - this.y;
          const distance = Math.sqrt(dx * dx + dy * dy);
          this.x += (dx / distance) * this.velocity;
          this.y += (dy / distance) * this.velocity;
          this.velocity *= 0.97; // é€æ¸å‡é€Ÿ

          // åˆ°è¾¾ç›®æ ‡ç‚¹ï¼Œè§¦å‘çˆ†ç‚¸
          if (distance < 8 || this.velocity < 1) {
            this.reachedTarget = true;
            this.explode(); // çˆ†ç‚¸é€»è¾‘
          }
        }
      }

      draw() {
        if (!this.reachedTarget) {
          // ç»˜åˆ¶å‘å°„è½¨è¿¹
          ctx.beginPath();
          ctx.moveTo(this.trail[0]?.x || this.x, this.trail[0]?.y || this.y);
          this.trail.forEach(point => {
            ctx.lineTo(point.x, point.y);
          });
          ctx.strokeStyle = this.color;
          ctx.lineWidth = 2;
          ctx.stroke();

          // ç»˜åˆ¶å½“å‰çƒŸèŠ±å¤´
          ctx.beginPath();
          ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill();
        }
      }

      // çˆ†ç‚¸æ ¸å¿ƒé€»è¾‘
      explode() {
        const particleCount = 150 + Math.floor(Math.random() * 100); // 150-250ä¸ªç²’å­
        const explosionSize = 80 + Math.random() * 40; // çˆ†ç‚¸èŒƒå›´

        // ç”Ÿæˆä¸»çˆ†ç‚¸ç²’å­
        for (let i = 0; i < particleCount; i++) {
          const angle = Math.random() * Math.PI * 2; // éšæœºè§’åº¦
          const speed = (Math.random() * 3 + 2) * (explosionSize / 100); // é€Ÿåº¦ä¸èŒƒå›´åŒ¹é…
          particles.push(new Particle(
            this.x, 
            this.y, 
            this.color,
            Math.cos(angle) * speed,
            Math.sin(angle) * speed
          ));
        }

        // ç”Ÿæˆçˆ†ç‚¸ç¬é—´çš„é—ªå…‰ç²’å­ï¼ˆæ›´äº®ã€æ¶ˆå¤±æ›´å¿«ï¼‰
        const sparkCount = 30 + Math.floor(Math.random() * 20);
        for (let i = 0; i < sparkCount; i++) {
          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 5 + 3;
          sparks.push(new Spark(
            this.x, 
            this.y, 
            `hsl(${Math.random() * 360}, 100%, 90%)`, // é«˜äº®è‰²
            Math.cos(angle) * speed,
            Math.sin(angle) * speed
          ));
        }
      }
    }

    // çˆ†ç‚¸ç²’å­ç±»ï¼ˆä¸»ç²’å­ï¼‰
    class Particle {
      constructor(x, y, color, vx, vy) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.vx = vx; // æ°´å¹³é€Ÿåº¦ï¼ˆä»çˆ†ç‚¸å‡½æ•°ä¼ å…¥ï¼‰
        this.vy = vy; // å‚ç›´é€Ÿåº¦ï¼ˆä»çˆ†ç‚¸å‡½æ•°ä¼ å…¥ï¼‰
        this.radius = 1.5 + Math.random() * 2; // ç²’å­å¤§å°éšæœº
        this.alpha = 1;
        this.decay = 0.015 + Math.random() * 0.01; // è¡°å‡é€Ÿåº¦éšæœº
        this.gravity = 0.04; // ä¸‹è½é‡åŠ›
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += this.gravity; // å—é‡åŠ›å½±å“ä¸‹è½
        this.alpha -= this.decay;

        // ç²’å­é—ªçƒæ•ˆæœï¼ˆéšæœºæ˜æš—å˜åŒ–ï¼‰
        this.radius = Math.max(0.5, this.radius + (Math.random() - 0.5) * 0.1);
      }

      draw() {
        if (this.alpha <= 0) return;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        // é¢œè‰²å¸¦é€æ˜åº¦
        ctx.fillStyle = `${this.color}${Math.floor(this.alpha * 255).toString(16).padStart(2, '0')}`;
        ctx.fill();
      }
    }

    // é—ªå…‰ç²’å­ç±»ï¼ˆçˆ†ç‚¸ç¬é—´çš„äº®ç‚¹ï¼‰
    class Spark {
      constructor(x, y, color, vx, vy) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.vx = vx;
        this.vy = vy;
        this.radius = 2 + Math.random() * 1.5;
        this.alpha = 1;
        this.decay = 0.05 + Math.random() * 0.03; // å¿«é€Ÿæ¶ˆå¤±
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.alpha -= this.decay;
        this.radius *= 0.95; // é€æ¸ç¼©å°
      }

      draw() {
        if (this.alpha <= 0) return;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = `${this.color}${Math.floor(this.alpha * 255).toString(16).padStart(2, '0')}`;
        ctx.fill();
      }
    }

    // ç‚¹å‡»å±å¹•è§¦å‘çƒŸèŠ±
    canvas.addEventListener('click', (e) => {
      fireworks.push(new Firework(e.clientX, e.clientY));
    });

    // åŠ¨ç”»å¾ªç¯
    function animate() {
      // èƒŒæ™¯æ¸æš—ï¼ˆä¿ç•™çƒŸèŠ±è½¨è¿¹æ®‹å½±ï¼‰
      ctx.fillStyle = 'rgba(0, 0, 0, 0.08)';
      ctx.fillRect(0, 0, width, height);

      // æ›´æ–°ç»˜åˆ¶çƒŸèŠ±
      fireworks.forEach((firework, i) => {
        firework.update();
        firework.draw();
        if (firework.reachedTarget) {
          fireworks.splice(i, 1);
        }
      });

      // æ›´æ–°ç»˜åˆ¶çˆ†ç‚¸ç²’å­
      particles.forEach((particle, i) => {
        particle.update();
        particle.draw();
        if (particle.alpha <= 0) {
          particles.splice(i, 1);
        }
      });

      // æ›´æ–°ç»˜åˆ¶é—ªå…‰ç²’å­
      sparks.forEach((spark, i) => {
        spark.update();
        spark.draw();
        if (spark.alpha <= 0) {
          sparks.splice(i, 1);
        }
      });

      requestAnimationFrame(animate);
    }

    animate();
  </script>
</body>
</html>
